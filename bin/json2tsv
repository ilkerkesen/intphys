#!/usr/bin/env python

import hydra
import os
import os.path as osp
import json

import click
from tqdm import tqdm

from intphys.data import CRAFT


@click.command()
@click.argument("path", type=click.Path(exists=True))
def main(path):
    path = osp.abspath(osp.expanduser(path))
    dataset = CRAFT(path=path, split="test")
    tsv_file = osp.join(path, "questions.tsv")

    with open(tsv_file, "w") as f:
        headers = (
            "video_index",
            "question_index",
            "split",
            "question_type",
            "question_family_index",
            "question",
            "answer",
        )

        # write first row, headers
        f.write("\t".join(headers) + "\n")

        for question in tqdm(dataset.questions):
            columns = [str(question[k]).lower() for k in headers]
            f.write("\t".join(columns) + "\n")
    print("done")


if __name__ == "__main__":
    main()
